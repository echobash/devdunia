<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/png" href="images/logo.png">
  <link rel="apple-touch-icon" href="images/logo.png">
  <title>Share Text across different devices - DevDunia</title>
  <meta name="description" content="Share any text by QR code â€“ polished, fast, and private.">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%); }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
    .pop { animation: pop .6s ease; } @keyframes pop { 0%{transform:scale(.8);opacity:0} 60%{transform:scale(1.05);opacity:1} 100%{transform:scale(1)} }
    .glow { box-shadow: 0 0 0 0 rgba(59,130,246,.35); animation: pulseGlow 1.6s ease-in-out infinite; }
    @keyframes pulseGlow { 0%{box-shadow:0 0 0 0 rgba(59,130,246,.35)} 70%{box-shadow:0 0 0 20px rgba(59,130,246,0)} 100%{box-shadow:0 0 0 0 rgba(59,130,246,0)} }
  </style>
</head>
<body class="h-screen lg:ml-72">
  <div class="fixed inset-0 -z-10 bg-gradient-to-br from-gray-900 via-slate-900 to-gray-900"></div>

  <div class="main-content">
    <div class="relative z-10 w-full px-4 pt-10 pb-16 sm:px-6 lg:px-10">

      <div class="text-center mb-10">
        <h1 class="text-3xl sm:text-4xl font-bold mb-4 tracking-tight text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-cyan-500">Share Text across different devices</h1>
        <p class="text-lg text-gray-400 max-w-2xl mx-auto">Paste text, generate a beautiful QR, scan to view and copy.</p>
      </div>

      <div id="compose" class="w-full bg-slate-800/70 backdrop-blur-md rounded-2xl border border-slate-700/60 p-6 min-h-[calc(100vh-12rem)] flex flex-col">
        <label class="block text-sm font-medium text-gray-300 mb-2">Your Text</label>
        <textarea id="shareText" rows="12" class="w-full px-4 py-3 bg-slate-700/50 border border-slate-600 rounded-xl text-gray-200 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent mono min-h-[60vh] flex-1" placeholder="Paste or type the text you want to share..."></textarea>
        <div class="flex items-center justify-between mt-4">
          <span id="charCount" class="text-xs text-gray-400">0 characters</span>
          <button id="makeQR" class="px-5 py-3 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors">Create QR</button>
        </div>
      </div>

      <div id="qrView" class="w-full hidden">
        <div class="bg-slate-800/70 backdrop-blur-md rounded-2xl border border-slate-700/60 p-6 text-center min-h-[calc(100vh-12rem)] flex flex-col items-center justify-center">
          <h2 class="text-xl font-semibold text-blue-400 mb-3">Scan to Open</h2>
          <div class="flex flex-col items-center">
            <div class="bg-white p-6 rounded-2xl glow pop">
              <canvas id="qrCanvas" width="512" height="512"></canvas>
            </div>
            <div class="mt-4 flex flex-wrap gap-3">
              <button id="downloadPNG" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm">Download PNG</button>
              <button id="backBtn" class="px-4 py-2 bg-slate-600 hover:bg-slate-700 text-white rounded-lg text-sm">Back</button>
            </div>
            <p id="qrNote" class="text-xs text-gray-400 mt-3">Tip: Share this QR on screen; scanning opens a view-only page to copy the text.</p>
          </div>
        </div>
      </div>

      <div id="reader" class="w-full hidden bg-slate-800/70 backdrop-blur-md rounded-2xl border border-slate-700/60 p-6 min-h-[calc(100vh-12rem)] flex flex-col">
        <h2 class="text-xl font-semibold text-cyan-400 mb-4">Shared Text</h2>
        <pre id="viewText" class="mono whitespace-pre-wrap text-gray-200 bg-slate-900/50 p-4 rounded-lg border border-slate-700/60 min-h-[60vh] flex-1"></pre>
        <div class="mt-4 flex gap-3">
          <button id="copyBtn" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm">Copy</button>
          <button id="newBtn" class="px-4 py-2 bg-slate-600 hover:bg-slate-700 text-white rounded-lg text-sm">Create new</button>
        </div>
      </div>

    </div>
  </div>

  <script>
  // Use the same API approach as qr-generator.html (api.qrserver.com)

  (function(){
    const shareText = document.getElementById('shareText');
    const charCount = document.getElementById('charCount');
    const makeQR = document.getElementById('makeQR');
    const compose = document.getElementById('compose');
    const qrView = document.getElementById('qrView');
    const qrCanvas = document.getElementById('qrCanvas');
    const backBtn = document.getElementById('backBtn');
    const downloadPNG = document.getElementById('downloadPNG');
    const reader = document.getElementById('reader');
    const viewText = document.getElementById('viewText');
    const copyBtn = document.getElementById('copyBtn');
    const newBtn = document.getElementById('newBtn');

    shareText.addEventListener('input',()=>{
      const n = shareText.value.length; charCount.textContent = `${n} character${n===1?'':'s'}`;
    });

    // Encode as Base64 (UTF-8 safe) for shorter/safer URLs
    function utf8ToB64(str){ return btoa(unescape(encodeURIComponent(str))); }
    function b64ToUtf8(b64){ return decodeURIComponent(escape(atob(b64))); }

    function makeLink(txt){
      const payload = utf8ToB64(txt);
      return `${location.origin}${location.pathname}?view=1#text=${payload}`;
    }

    function showQR(txt){
      const url = makeLink(txt);
      const size = 360;
      const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=${size}x${size}&data=${encodeURIComponent(url)}`;
      const img = new Image();
      img.crossOrigin = 'anonymous';
      img.onload = function(){
        const ctx = qrCanvas.getContext('2d');
        qrCanvas.width = size; qrCanvas.height = size;
        ctx.clearRect(0,0,size,size);
        ctx.drawImage(img,0,0,size,size);
        compose.classList.add('hidden');
        reader.classList.add('hidden');
        qrView.classList.remove('hidden');
      };
      img.onerror = function(){
        alert('Failed to generate QR. Please check your connection and try again.');
      };
      img.src = qrUrl;
      downloadPNG.onclick = () => {
        const link=document.createElement('a');
        link.download='text-share-qr.png';
        link.href = qrUrl; // download original
        link.click();
      };
    }

    makeQR.addEventListener('click',()=>{
      const txt = shareText.value.trim();
      if(!txt){ alert('Please enter some text.'); return; }
      showQR(txt);
    });

    backBtn.addEventListener('click',()=>{
      qrView.classList.add('hidden');
      compose.classList.remove('hidden');
    });

    copyBtn.addEventListener('click',()=>{
      navigator.clipboard.writeText(viewText.textContent||'');
      copyBtn.textContent='Copied!'; setTimeout(()=>copyBtn.textContent='Copy',1200);
    });
    newBtn.addEventListener('click',()=>{
      location.href = location.pathname; // reset
    });

    // Reader mode
    const params = new URLSearchParams(location.search);
    if(params.get('view')==='1'){
      let h = '';
      if(location.hash.startsWith('#text=')){
        const raw = location.hash.slice(6);
        try { h = b64ToUtf8(raw); }
        catch(e){
          // Fallback for older links that used encodeURIComponent
          try { h = decodeURIComponent(raw); } catch(_) { h = raw; }
        }
      }
      if(h){
        compose.classList.add('hidden');
        qrView.classList.add('hidden');
        reader.classList.remove('hidden');
        viewText.textContent = h;
      }
    }
  })();
  </script>

  <!-- Include Final Sidebar -->
  <div id="sidebar-container"></div>
  <script>
    fetch('final_sidebar.html')
      .then(r => r.text())
      .then(html => { document.getElementById('sidebar-container').innerHTML = html; })
      .catch(()=>{});
  </script>
</body>
</html>


